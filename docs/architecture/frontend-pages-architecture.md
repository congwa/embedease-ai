# 前端页面架构设计

## 一、整体架构概览

```
/admin                          # 管理后台根路由
├── /                           # 仪表盘（Dashboard）
├── /quick-setup               # 快速设置向导 ⭐
├── /agents                    # Agent 管理
│   ├── /                      # Agent 列表
│   └── /[agentId]            # Agent 控制台（动态路由）
│       ├── /                  # 基础设置
│       ├── /tools            # 工具配置
│       ├── /conversations    # 会话洞察
│       ├── /knowledge        # 知识库（kb/faq类型）
│       ├── /faq              # FAQ管理（faq类型）
│       ├── /greeting         # 欢迎语配置
│       ├── /middleware       # 中间件配置
│       ├── /memory           # 记忆配置
│       └── /suggested-questions  # 推荐问题
├── /settings                  # 设置中心
│   ├── /                      # 设置总览
│   ├── /llm-config           # LLM 配置
│   └── /supervisor           # Supervisor 全局配置 ⭐
├── /skills                    # 技能管理
│   ├── /                      # 技能列表
│   ├── /create               # 创建技能
│   ├── /generate             # AI生成技能
│   └── /[id]                 # 技能详情/编辑
├── /crawler                   # 爬虫管理
│   ├── /                      # 概览
│   ├── /sites                # 站点配置
│   ├── /tasks                # 任务列表
│   └── /pages                # 页面数据
├── /products                  # 商品数据
├── /conversations             # 会话管理
├── /users                     # 用户管理
├── /knowledge                 # 知识库（全局）- 可考虑移除
├── /faq                       # FAQ（全局）- 可考虑移除
└── /prompts                   # 提示词管理 - 可考虑移除
```

---

## 二、模式选择机制

### 2.1 模式入口位置

| 入口 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| **Quick Setup 向导** | `/admin/quick-setup` | 首次配置时的引导流程，第2步选择模式 | **主入口** |
| **设置中心** | `/admin/settings` | 添加模式切换卡片，可快速切换 | 辅助入口 |
| **仪表盘** | `/admin` | 显示当前模式状态，提供跳转链接 | 状态展示 |

### 2.2 模式说明

| 模式 | 标识 | 特点 | 适用场景 |
|------|------|------|----------|
| **单 Agent 模式** | `single` | 一个 Agent 处理所有请求 | 简单场景、单一业务 |
| **Supervisor 模式** | `supervisor` | 多 Agent 协作，智能路由 | 复杂场景、多业务线 |

### 2.3 模式切换影响

```
模式切换时：
├── 后端：更新全局 Supervisor 配置 (enabled: true/false)
├── Quick Setup：动态调整后续步骤列表
└── 前端：
    ├── 仪表盘：显示不同的状态卡片
    ├── 设置中心：显示/隐藏 Supervisor 相关配置
    └── 侧边栏：可选显示不同菜单项
```

---

## 三、页面功能详解

### 3.1 仪表盘 `/admin`

**职责**：系统数据概览 + 快速导航

```
┌─────────────────────────────────────────────────────────┐
│  仪表盘                                                  │
├─────────────────────────────────────────────────────────┤
│  [核心指标]                                              │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐                    │
│  │商品数│ │会话数│ │用户数│ │消息数│                    │
│  └──────┘ └──────┘ └──────┘ └──────┘                    │
│                                                         │
│  [Agent概览]              [多Agent编排]                  │
│  ┌──────────────┐        ┌──────────────┐               │
│  │ 总数/启用/子Agent    │ │ 模式状态      │               │
│  │ 默认Agent →          │ │ 子Agent数量   │               │
│  └──────────────┘        │ 管理配置 →    │               │
│                          └──────────────┘               │
│                                                         │
│  [爬虫统计]               [会话状态]                     │
└─────────────────────────────────────────────────────────┘
```

**待添加**：模式切换快捷入口

---

### 3.2 Quick Setup 向导 `/admin/quick-setup`

**职责**：首次配置引导 + 模式选择

```
向导流程：
┌────────┐    ┌────────┐    ┌────────┐
│Welcome │ → │ Mode   │ → │ System │ → ...
└────────┘    └────────┘    └────────┘
                  │
                  ├─→ single:    [Agent Type] → [Knowledge] → [Greeting]
                  │
                  └─→ supervisor: [Supervisor] → [Greeting]
                                        ↓
                              [Channel] → [Summary]
```

**步骤组件**：
| 步骤 | 组件 | 说明 |
|------|------|------|
| welcome | `WelcomeStep` | 欢迎页 |
| mode | `ModeStep` | **模式选择**（单Agent/Supervisor） |
| system | `SystemStep` | 系统配置 |
| models | `ModelsStep` | 模型配置 |
| agent-type | `AgentTypeStep` | Agent类型（仅单Agent模式） |
| knowledge | `KnowledgeStep` | 知识库配置 |
| supervisor | `SupervisorStep` | Supervisor配置（仅Supervisor模式） |
| greeting | `GreetingStep` | 欢迎语配置 |
| channel | `ChannelStep` | 渠道配置 |
| summary | `SummaryStep` | 完成总结 |

---

### 3.3 设置中心 `/admin/settings`

**职责**：系统配置查看与管理

```
┌─────────────────────────────────────────────────────────┐
│  设置中心                                                │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [运行模式] ⭐ 新增                                      │
│  ┌──────────────────────────────────────────┐          │
│  │ 当前模式: 单Agent / Supervisor            │          │
│  │ [切换模式] 按钮                           │          │
│  └──────────────────────────────────────────┘          │
│                                                         │
│  [配置卡片网格]                                          │
│  ┌────────┐ ┌────────┐ ┌────────┐                      │
│  │LLM配置 │ │Embedding│ │Rerank  │                      │
│  └────────┘ └────────┘ └────────┘                      │
│  ┌────────┐ ┌────────┐ ┌────────┐                      │
│  │Memory  │ │Qdrant  │ │MinIO   │                      │
│  └────────┘ └────────┘ └────────┘                      │
│                                                         │
│  [全局中间件配置]                                        │
│  [Agent中间件对比]                                       │
└─────────────────────────────────────────────────────────┘
```

**子页面**：
- `/admin/settings/llm-config` - LLM 配置编辑
- `/admin/settings/supervisor` - Supervisor 全局配置

---

### 3.4 Supervisor 配置 `/admin/settings/supervisor`

**职责**：全局 Supervisor 模式配置

```
┌─────────────────────────────────────────────────────────┐
│  多Agent编排配置                                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [启用开关]                                              │
│  ┌──────────────────────────────────────────┐          │
│  │ 启用 Supervisor 模式    [开关]            │          │
│  └──────────────────────────────────────────┘          │
│                                                         │
│  [子Agent列表]                                          │
│  ┌──────────────────────────────────────────┐          │
│  │ #1 商品助手  优先级:100  关键词:商品,推荐  │          │
│  │ #2 FAQ助手   优先级:90   关键词:问题,帮助  │          │
│  │ [+ 添加子Agent]                          │          │
│  └──────────────────────────────────────────┘          │
│                                                         │
│  [路由策略]                                              │
│  - 策略类型: 混合模式                                    │
│  - 默认Agent: 选择                                      │
│                                                         │
│  [调度提示词]                                            │
│  [多行文本框...]                                         │
│                                                         │
│  [保存配置]                                              │
└─────────────────────────────────────────────────────────┘
```

---

### 3.5 Agent 管理

#### 3.5.1 Agent 列表 `/admin/agents`

```
┌─────────────────────────────────────────────────────────┐
│  Agent 列表                           [+ 创建Agent]      │
├─────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────────┐ │
│  │ 商品推荐助手  [product] [启用] [默认]   [管理→]    │ │
│  │ FAQ助手       [faq]     [启用]          [管理→]    │ │
│  │ 知识库助手    [kb]      [禁用]          [管理→]    │ │
│  └────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### 3.5.2 Agent 控制台 `/admin/agents/[agentId]`

**动态侧边栏菜单**（根据Agent类型显示）：

| 菜单项 | 路径 | 条件 |
|--------|------|------|
| 基础设置 | `/admin/agents/[id]` | 始终显示 |
| 工具配置 | `/admin/agents/[id]/tools` | 始终显示 |
| 会话洞察 | `/admin/agents/[id]/conversations` | 始终显示 |
| 商品数据 | `/admin/products` | 仅 `product` 类型 |
| FAQ管理 | `/admin/agents/[id]/faq` | 仅 `faq` 类型 |
| 知识库 | `/admin/agents/[id]/knowledge` | `kb` 或 `faq` 类型 |

---

## 四、侧边栏结构

```
┌──────────────────────┐
│  管理后台            │
├──────────────────────┤
│  [当前Agent切换器]   │
│  ┌────────────────┐  │
│  │ 选择Agent  ▼   │  │
│  └────────────────┘  │
├──────────────────────┤
│  基础菜单            │
│  • 仪表盘            │
│  • Quick Setup       │
├──────────────────────┤
│  Agent控制台         │
│  (动态根据选中Agent) │
│  • 基础设置          │
│  • 工具配置          │
│  • 会话洞察          │
│  • [类型相关菜单]    │
├──────────────────────┤
│  系统管理            │
│  • Agent列表         │
│  • 技能管理          │
│  • 爬虫管理 ▼        │
│    - 站点配置        │
│    - 任务列表        │
│    - 页面数据        │
│  • 会话管理          │
│  • 用户管理          │
│  • 设置中心          │
├──────────────────────┤
│  客服工作台 [通知]   │
└──────────────────────┘
```

---

## 五、待清理/整合的页面

| 路径 | 当前状态 | 建议 |
|------|----------|------|
| `/admin/knowledge` | 全局知识库 | 移除，统一到 Agent 级别 |
| `/admin/faq` | 全局FAQ | 移除，统一到 Agent 级别 |
| `/admin/prompts` | 提示词管理 | 评估是否需要，或整合到技能 |

---

## 六、建议新增功能

### 6.1 设置中心添加模式切换

在 `/admin/settings` 页面顶部添加"运行模式"卡片：

```tsx
<Card>
  <CardHeader>
    <CardTitle>运行模式</CardTitle>
  </CardHeader>
  <CardContent>
    <div className="flex items-center justify-between">
      <div>
        <p>当前模式: {mode === 'supervisor' ? 'Supervisor多Agent' : '单Agent'}</p>
        <p className="text-sm text-muted-foreground">
          {mode === 'supervisor' 
            ? '多个Agent协作，智能路由用户请求' 
            : '单个Agent处理所有请求'}
        </p>
      </div>
      <Button variant="outline" onClick={() => router.push('/admin/quick-setup')}>
        切换模式
      </Button>
    </div>
  </CardContent>
</Card>
```

### 6.2 仪表盘模式状态增强

在仪表盘的"多Agent编排"卡片中增加快速切换入口。

---

## 七、API 端点映射

| 功能 | 端点 | 说明 |
|------|------|------|
| 获取当前模式 | `GET /api/v1/admin/quick-setup/state/mode` | 返回 single/supervisor |
| 设置模式 | `POST /api/v1/admin/quick-setup/state/mode/{mode}` | 切换并更新步骤 |
| Supervisor配置 | `GET/POST /api/v1/admin/system-config/supervisor` | 全局配置 |
| 可选子Agent | `GET /api/v1/admin/system-config/supervisor/available-agents` | 列表 |

---

## 八、实施优先级

1. **P0（已完成）**：Quick Setup 模式选择
2. **P1（待实现）**：设置中心添加模式切换入口
3. **P2（待实现）**：仪表盘模式状态增强
4. **P3（待评估）**：清理冗余全局页面
